<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Puter Sora Video Generator</title>
<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
    }
    #status {
        margin-top: 10px;
        font-size: 18px;
        color: #444;
        white-space: pre-wrap;
    }
    video {
        margin-top: 20px;
        width: 100%;
        max-width: 720px;
        border-radius: 10px;
    }
</style>
</head>
<body>

<h2>KI‑Video generieren</h2>

<input id="prompt" type="text" placeholder="Beschreibe dein Video..." style="width:100%; padding:10px;">
<button id="generateBtn" style="margin-top:10px; padding:10px 20px;">Video generieren</button>

<div id="status"></div>
<div id="output"></div>

<!-- Puter SDK -->
<script src="https://js.puter.com/v2/" defer></script>

<script>
document.getElementById("generateBtn").onclick = async () => {
    const prompt = document.getElementById("prompt").value.trim();
    const status = document.getElementById("status");
    const output = document.getElementById("output");

    status.textContent = "";
    output.innerHTML = "";

    if (!prompt) {
        status.textContent = "Bitte gib eine Videobeschreibung ein.";
        return;
    }

    /* -------------------------------
       ✅ DEBUG 1: Ist puter geladen?
    --------------------------------*/
    console.log("DEBUG → puter:", window.puter);
    if (!window.puter) {
        status.textContent = "Fehler: puter ist undefined (SDK nicht geladen oder blockiert).";
        return;
    }

    /* --------------------------------------
       ✅ DEBUG 2: Ist puter.ai verfügbar?
    ---------------------------------------*/
    console.log("DEBUG → puter.ai:", window.puter.ai);
    if (!window.puter.ai) {
        status.textContent = "Fehler: puter.ai ist undefined (AI‑Modul nicht verfügbar).";
        return;
    }

    /* ---------------------------------------------------
       ✅ DEBUG 3: Ist puter.ai.txt2vid verfügbar?
    ----------------------------------------------------*/
    console.log("DEBUG → puter.ai.txt2vid:", window.puter.ai.txt2vid);
    if (!window.puter.ai.txt2vid) {
        status.textContent = "Fehler: puter.ai.txt2vid ist undefined (Video‑Feature nicht verfügbar).";
        return;
    }

    // Wenn alle Debug‑Checks bestanden sind → Video generieren
    status.textContent = "Video wird generiert... das kann 1–2 Minuten dauern.";

    try {
        const video = await puter.ai.txt2vid(prompt, {
            model: "sora-2-pro",
            seconds: 12,
            size: "1280x720"
        });

        /* ✅ PATCH: RAW‑RESULT anzeigen */
        console.log("RAW RESULT:", video);

        // Wenn Puter ein Fehlerobjekt zurückgibt statt eines Videos
        if (video && video.success === false) {
            console.log("PUTER ERROR DETAILS:", video.error);
            status.textContent = "Puter Fehler:\n" + JSON.stringify(video.error, null, 2);
            return;
        }

        status.textContent = "Video fertig!";
        output.appendChild(video);

        video.addEventListener("loadeddata", () => {
            video.play().catch(() => {});
        });

    } catch (err) {

        /* ✅ PATCH: Vollständiges Error‑Objekt anzeigen */
        console.error("FULL ERROR OBJECT:", err);

        if (err?.error) {
            console.log("PUTER ERROR DETAILS:", err.error);
            status.textContent = "Puter Fehler:\n" + JSON.stringify(err.error, null, 2);
        } else {
            status.textContent = "Fehler beim Generieren: " + (err?.message || "undefined");
        }
    }
};
</script>

</body>
</html>
